(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["3186b08a"],{6870:function(t,e,s){},"84a3":function(t,e,s){"use strict";var n=s("af3c"),i=s.n(n);i.a},af3c:function(t,e,s){},eb60:function(t,e,s){"use strict";var n=s("6870"),i=s.n(n);i.a},f241:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-layout",{attrs:{view:"hHh Lpr lFf"}},[s("client-settings",{attrs:{settings:t.currentSettings},on:{save:t.saveSettingsHandler,hide:t.hideSettingsHandler},model:{value:t.clientSettingsOpened,callback:function(e){t.clientSettingsOpened=e},expression:"clientSettingsOpened"}}),t.fullViewMode?s("q-layout-header",[s("q-toolbar",{attrs:{color:"dark"}},[s("q-btn",{attrs:{flat:"",rounded:"",icon:"mdi-menu"},on:{click:function(e){t.leftDrawerOpen=!t.leftDrawerOpen}}}),s("q-toolbar-title",{staticStyle:{"line-height":"36px"}},[s("img",{staticStyle:{height:"30px","vertical-align":"text-bottom"},attrs:{src:"statics/mqtttiles-logo.png",alt:"MQTT Tiles"}}),t._v("\n        MQTT Tiles\n        "),s("sup",{staticStyle:{position:"relative","font-size":".9rem","padding-left":"4px"}},[t._v(t._s(t.version))])])],1)],1):t._e(),t.fullViewMode?s("q-layout-drawer",{attrs:{side:"left"},model:{value:t.leftDrawerOpen,callback:function(e){t.leftDrawerOpen=e},expression:"leftDrawerOpen"}},[s("div",{staticClass:"connections__subheader q-px-md bg-dark",staticStyle:{position:"relative",height:"70px"}},[s("span",{staticClass:"text-white",staticStyle:{"font-size":"1.4rem","line-height":"70px"}},[t._v("My connections")]),s("q-btn",{staticClass:"text-dark",staticStyle:{position:"absolute",bottom:"-20px",right:"16px","z-index":"1"},attrs:{"fab-mini":"",icon:"mdi-plus",color:"white"},on:{click:t.openSettings}})],1),t.clientsIds.length?s("q-list",{staticClass:"scroll",staticStyle:{position:"absolute",top:"70px",bottom:"0",right:"0",left:"0"}},[s("q-list-header",[s("span",[t._v("Connections")])]),t._l(t.clients,function(e,n){var i;return s("q-item",{key:n,staticClass:"cursor-pointer",class:{active:n===t.activeClientId},nativeOn:{click:function(e){t.setActiveClient(n)}}},[s("q-item-side",[t.connected&&n===t.activeClientId?s("q-btn",{attrs:{icon:"mdi-lan-connect",dense:"",flat:""},on:{click:function(e){e.stopPropagation(),t.setActiveClient()}}},[s("q-tooltip",[t._v("Disconnect")])],1):s("q-icon",{staticClass:"q-ma-xs",attrs:{name:"mdi-lan-disconnect",size:"1.3rem"}},[n===t.activeClientId?s("q-tooltip"):t._e()],1)],1),s("q-item-main",[s("q-item-tile",{staticClass:"ellipsis",class:(i={},i["text-"+(t.connected?"green":"red")+"-6"]=n===t.activeClientId,i),attrs:{label:""}},[t._v("\n            "+t._s(e.clientName)+"\n          ")]),s("q-item-tile",{staticClass:"ellipsis",attrs:{sublabel:""}},[t._v(t._s(e.host))])],1),s("q-item-side",{attrs:{right:""}},[s("q-btn",{attrs:{round:"",flat:"",icon:"mdi-dots-vertical"},on:{click:function(t){t.stopPropagation()}}},[s("q-popover",{attrs:{anchor:"bottom right",self:"top right"}},[s("q-list",[s("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],staticClass:"cursor-pointer",attrs:{highlight:""},nativeOn:{click:function(e){t.editClientSettings(n)}}},[s("q-item-side",{attrs:{icon:"mdi-settings"}}),s("q-item-main",{attrs:{label:"Edit"}})],1),s("q-item-separator"),s("q-item",{directives:[{name:"close-overlay",rawName:"v-close-overlay"}],staticClass:"cursor-pointer",attrs:{highlight:""},nativeOn:{click:function(e){t.removeClient(n)}}},[s("q-item-side",{attrs:{color:"red",icon:"mdi-delete-outline"}}),s("q-item-main",{attrs:{label:"Remove"}})],1)],1)],1)],1)],1)],1)})],2):s("div",{staticClass:"q-px-md q-pt-lg text-center"},[s("div",{staticClass:"text-bold"},[t._v("No connections")]),s("div",{staticStyle:{"font-size":".8rem"}},[t._v("Create a connection to visualize its data on boards")])])],1):t._e(),s("q-page-container",[s("router-view",{attrs:{client:t.clients[t.activeClientId]},on:{"change:status":t.changeStatus,share:t.shareHandler,"change:attach":t.changeAttachedBoards,"delete:boards":t.deleteBoardsHandler,"add:boards":t.addBoardsHandler}})],1)],1)},i=[];n._withStripped=!0;s("6b54"),s("a481"),s("6762"),s("2fdb");var r=s("448a"),a=s.n(r),o=(s("ac6a"),s("cadf"),s("456d"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-modal",{on:{hide:t.closeHandler},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}},[s("q-modal-layout",[s("q-toolbar",{attrs:{slot:"header",color:"dark"},slot:"header"},[s("q-toolbar-title",[t._v("\n        MQTT client\n      ")])],1),s("div",{staticStyle:{margin:"20px"},style:{height:t.$q.platform.is.mobile?"calc(100% - 100px)":"50vh",width:t.$q.platform.is.mobile?"calc(100% - 40px)":"50vw"}},[s("q-input",{attrs:{color:"dark","float-label":"MQTT client name",error:!t.currentSettings.clientName},model:{value:t.currentSettings.clientName,callback:function(e){t.$set(t.currentSettings,"clientName",e)},expression:"currentSettings.clientName"}}),s("q-input",{attrs:{color:"dark","float-label":"Client ID",error:!t.currentSettings.clientId,after:[{icon:"mdi-refresh",handler:function(){t.currentSettings.clientId="mqtt-tiles-"+Math.random().toString(16).substr(2,8)}}]},model:{value:t.currentSettings.clientId,callback:function(e){t.$set(t.currentSettings,"clientId",e)},expression:"currentSettings.clientId"}}),s("q-input",{attrs:{color:"dark","float-label":"Host",error:!t.currentSettings.host||0===t.currentSettings.host.indexOf("ws:"),after:[{icon:"mdi-alert-outline",handler:t.hostErrorHandler,error:!0}]},model:{value:t.currentSettings.host,callback:function(e){t.$set(t.currentSettings,"host",e)},expression:"currentSettings.host"}}),s("q-input",{attrs:{color:"dark",type:"number","float-label":"Keep alive"},model:{value:t.currentSettings.keepalive,callback:function(e){t.$set(t.currentSettings,"keepalive",e)},expression:"currentSettings.keepalive"}}),s("q-select",{attrs:{color:"dark",options:[{label:"3.1.1",value:4},{label:"5.0",value:5}],"float-label":"Version of MQTT"},model:{value:t.currentSettings.protocolVersion,callback:function(e){t.$set(t.currentSettings,"protocolVersion",e)},expression:"currentSettings.protocolVersion"}}),s("q-checkbox",{staticClass:"q-mr-sm",staticStyle:{height:"56px"},attrs:{color:"dark",label:5===t.currentSettings.protocolVersion?"Clean start":"Clean session"},model:{value:t.currentSettings.clean,callback:function(e){t.$set(t.currentSettings,"clean",e)},expression:"currentSettings.clean"}}),5===t.currentSettings.protocolVersion?s("q-input",{staticStyle:{display:"inline-flex",width:"calc(100% - 115px)"},attrs:{color:"dark",type:"number","float-label":"Session expiry interval",clearable:"","clear-value":void 0},model:{value:t.currentSettings.properties.sessionExpiryInterval,callback:function(e){t.$set(t.currentSettings.properties,"sessionExpiryInterval",e)},expression:"currentSettings.properties.sessionExpiryInterval"}}):t._e(),s("q-input",{attrs:{color:"dark","float-label":"Username","clear-value":void 0,after:[{icon:"mdi-login",handler:t.flespiLoginHandler,condition:-1!==t.currentSettings.host.indexOf("flespi")}]},model:{value:t.currentSettings.username,callback:function(e){t.$set(t.currentSettings,"username",e)},expression:"currentSettings.username"}}),s("q-input",{attrs:{color:"dark","float-label":"Password","clear-value":void 0},model:{value:t.currentSettings.password,callback:function(e){t.$set(t.currentSettings,"password",e)},expression:"currentSettings.password"}}),5===t.currentSettings.protocolVersion?s("q-collapsible",{staticClass:"q-mt-md q-mb-sm bg-grey-4",attrs:{label:"Subscribe User Properties"}},[s("div",[t.currentSettings.userProperties?s("q-list",t._l(t.currentSettings.userProperties,function(e,n){return s("q-item",{key:n+": "+e},[s("q-icon",{staticClass:"q-mr-sm cursor-pointer",attrs:{size:"1rem",name:"mdi-close-circle"},nativeOn:{click:function(e){t.removeUserProperty(n)}}}),s("span",[t._v(t._s(n+": "+e))])],1)})):t._e(),s("q-input",{attrs:{color:"dark","float-label":"User property name"},model:{value:t.userProperty.name,callback:function(e){t.$set(t.userProperty,"name",e)},expression:"userProperty.name"}}),s("q-input",{attrs:{color:"dark","float-label":"User property value"},model:{value:t.userProperty.value,callback:function(e){t.$set(t.userProperty,"value",e)},expression:"userProperty.value"}}),s("q-btn",{staticClass:"q-mt-sm",staticStyle:{width:"100%"},attrs:{disable:!t.userProperty.name||!t.userProperty.value,color:"dark"},on:{click:t.addUserProperty}},[t._v("Add")])],1)]):t._e(),5===t.currentSettings.protocolVersion&&-1!==t.currentSettings.host.indexOf("flespi.io")?s("div",{staticClass:"share-tokens__items-wrapper col-12 relative-position q-mt-lg q-mb-md"},[s("q-list",[s("q-btn",{staticClass:"col-12",staticStyle:{top:"-20px",right:"8px",position:"absolute","z-index":"1130"},attrs:{color:"dark","fab-mini":"",icon:"mdi-plus"},on:{click:t.addSyncCredsItem}}),s("q-list-header",[s("div",{class:{"text-red-6":!t.currentSettings.syncCreds||!t.currentSettings.syncCreds.length}},[t._v("Tokens for sharing"+t._s(t.currentSettings.syncCreds&&t.currentSettings.syncCreds.length?"":" are empty"))]),s("div",{staticClass:"text-grey-6 q-mt-xs",staticStyle:{"font-size":".8rem"}},[t._v("List of standard or ACL flespi tokens to be used for sharing boards.")])]),t._l(t.currentSettings.syncCreds,function(e,n){return s("q-collapsible",{key:""+n,attrs:{group:"singleselect-items","header-class":["bg-"+(t.checkUniqueSyncCredsValue(e,n)?"grey-4":"red-2")],"collapse-icon":"mdi-settings",opened:!0}},[s("template",{slot:"header"},[s("q-item-side",{attrs:{right:""}},[s("q-btn",{staticClass:"col-1",attrs:{disabled:0===n,round:"",dense:"",flat:"",icon:"mdi-arrow-up"},on:{click:function(e){e.stopPropagation(),t.upItem(n)}}}),s("q-btn",{staticClass:"col-1",attrs:{disabled:n===t.currentSettings.syncCreds.length-1,round:"",dense:"",flat:"",icon:"mdi-arrow-down"},on:{click:function(e){e.stopPropagation(),t.downItem(n)}}})],1),s("q-item-main",[s("q-item-tile",{staticClass:"ellipsis"},[t._v(t._s(e.label?e.label:"Item "+(n+1)))]),s("q-item-tile",{staticClass:"text-grey-8 ellipsis",staticStyle:{"font-size":".8rem"}},[t._v(t._s(e.credentions.username||"*Empty*"))])],1),s("q-item-side",{attrs:{right:""}},[s("q-btn",{attrs:{flat:"",color:"red-6",round:"",dense:"",icon:"mdi-delete"},on:{click:function(e){e.stopPropagation(),t.removeSyncCredsItem(n)}}})],1)],1),s("div",{staticClass:"row"},[s("div",{staticClass:"col-12"},[s("q-input",{staticClass:"q-mr-xs",attrs:{autofocus:"",color:"dark","float-label":"Label"},model:{value:e.label,callback:function(s){t.$set(e,"label",s)},expression:"syncCreds.label"}})],1),s("div",{staticClass:"col-12"},[s("q-input",{staticClass:"q-ml-xs",attrs:{color:"dark","float-label":"Token",error:!t.checkUniqueSyncCredsValue(e,n)},model:{value:e.credentions.username,callback:function(s){t.$set(e.credentions,"username",s)},expression:"syncCreds.credentions.username"}})],1)])],2)})],2)],1):t._e()],1),s("q-toolbar",{attrs:{slot:"footer",color:"dark"},slot:"footer"},[s("q-toolbar-title"),s("q-btn",{staticClass:"q-mr-sm",attrs:{flat:"",dense:""},on:{click:t.closeHandler}},[t._v("Close")]),s("q-btn",{attrs:{flat:"",dense:"",disable:!t.validateCurrentSettings},on:{click:t.saveSettingsHandler}},[t._v(t._s(t.settings?"Update":"Save"))])],1)],1)],1)}),l=[];o._withStripped=!0;s("7f7f");var c=s("42454"),d=s.n(c),u=function(){return{clientName:"New client",clientId:"mqtt-tiles-".concat(Math.random().toString(16).substr(2,8)),host:"wss://mqtt.flespi.io",keepalive:60,protocolVersion:5,clean:!0,username:"FlespiToken XXXXXXXXXXXXXXXXXXX",password:"",properties:{sessionExpiryInterval:void 0},syncNamespace:"xflespifront/mqtttiles/boards"}},h=s("0644"),p=s.n(h),m={name:"ClientSettings",props:["value","settings"],data:function(){var t=u();return{defaultSettings:t,currentSettings:this.settings?d()({},t,this.settings):d()({},t),userProperty:{name:"",value:""},syncCreds:{label:"",credentions:{username:""}}}},computed:{validateCurrentSettings:function(){return!!this.currentSettings.clientId&&!!this.currentSettings.host&&!(0===this.currentSettings.host.indexOf("ws:"))&&(!this.currentSettings.syncCreds||!this.currentSettings.syncCreds.length||!!this.currentSettings.syncCreds&&!!this.currentSettings.syncCreds.length&&this.currentSettings.syncCreds.reduce(function(t,e,s,n){var i=e.credentions.username;return t[i]||(t[i]=0),t[i]++,s===n.length-1?Object.keys(t).reduce(function(e,s){return e?1===t[s]:e},!0):t},{}))},status:function(){return this.value}},methods:{saveSettingsHandler:function(){var t=this;this.$emit("save",this.currentSettings),this.closeHandler(),this.$nextTick(function(){t.defaultSettings.clientId="mqtt-tiles-".concat(Math.random().toString(16).substr(2,8)),t.currentSettings=d()({},t.defaultSettings)})},closeHandler:function(){this.$emit("input",!1),this.$emit("hide")},hostErrorHandler:function(){this.$q.notify({message:"Host must be not empty and only over secured sockets"})},addUserProperty:function(){this.currentSettings.userProperties||this.$set(this.currentSettings,"userProperties",{}),this.$set(this.currentSettings.userProperties,this.userProperty.name,this.userProperty.value),this.userProperty={value:"",name:""}},removeUserProperty:function(t){this.$delete(this.currentSettings.userProperties,t),Object.keys(this.currentSettings.userProperties).length||this.$set(this.currentSettings,"userProperties",null)},flespiLoginHandler:function(){var t=this,e=function e(s){"string"===typeof s.data&&~s.data.indexOf("FlespiToken")&&(t.currentSettings.username=s.data,window.removeEventListener("message",e))};window.addEventListener("message",e),this.openWindow("https://flespi.io/login/#/providers")},openWindow:function(t,e){e=e||"auth";var s=500,n=600,i=void 0!==window.screenLeft?window.screenLeft:screen.left,r=void 0!==window.screenTop?window.screenTop:screen.top,a=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,o=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,l=a/2-s/2+i,c=o/2-n/2+r,d=window.open(t,e,"toolbar=no,location=no,status=yes,resizable=yes,scrollbars=yes, width="+s+", height="+n+", top="+c+", left="+l);window.focus&&d.focus()},addSyncCredsItem:function(){this.currentSettings.syncCreds||this.$set(this.currentSettings,"syncCreds",[]),this.currentSettings.syncCreds.push(p()(this.syncCreds))},removeSyncCredsItem:function(t){this.$delete(this.currentSettings.syncCreds,t)},upSyncCredsItem:function(t){var e=this.currentSettings.syncCreds.splice(t,1)[0];this.currentSettings.syncCreds.splice(t-1,0,e)},downSyncCredsItem:function(t){var e=this.currentSettings.syncCreds.splice(t,1)[0];this.currentSettings.syncCreds.splice(t+1,0,e)},checkUniqueSyncCredsValue:function(t,e){var s=!0;return this.currentSettings.syncCreds.map(function(t){return t.credentions.username}).some(function(n,i){var r=n===t.credentions.username;return r&&(s=i===e),r}),s}},watch:{settings:function(t){this.currentSettings=d()({},this.defaultSettings,t)}}},g=m,f=(s("84a3"),s("2877")),v=Object(f["a"])(g,o,l,!1,null,null,null);v.options.__file="ClientSettings.vue";var S=v.exports,b=s("f9d8"),y=s("b047c"),q=s.n(y),C=s("2b0e"),k=s("27ae"),w=s("5a50"),x=s("9224"),I=q()(function(t){b["a"].set(w["c"],t)},500,{trailing:!0}),_={name:"MyLayout",data:function(){return{leftDrawerOpen:this.$q.platform.is.desktop,clientSettingsOpened:!1,currentSettings:void 0,clients:{},activeClientId:void 0,editedClientId:void 0,connected:!1,version:x["a"],fullViewMode:!0}},computed:{clientsIds:function(){return Object.keys(this.clients)}},methods:{openSettings:function(){this.clientSettingsOpened=!0},hideSettingsHandler:function(){this.currentSettings=void 0,this.editedClientId=void 0},saveSettingsHandler:function(t){var e=this.editedClientId?this.editedClientId:this.clientsIds.length?parseInt(this.clientsIds[this.clientsIds.length-1])+1:0;C["default"].set(this.clients,e,t)},editClientSettings:function(t){this.currentSettings=this.clients[t],this.editedClientId=t,this.openSettings()},removeClient:function(t){var e=this;this.$q.dialog({title:"Delete client?",message:"Do you really want to delete «".concat(this.clients[t].clientName,"» client?"),color:"dark",ok:!0,cancel:!0}).then(function(){e.activeClientId===t&&(e.activeClientId=void 0),C["default"].delete(e.clients,t)})},setActiveClient:function(t){this.activeClientId=t,b["a"].set(w["a"],t)},changeStatus:function(t){this.connected=t},shareHandler:function(t){},clearAttachMode:function(t){this.$q.notify({message:"No boards attached to the connection. Showing all available boards.",timeout:3e3,type:"info",icon:"mdi-link-variant",position:"bottom-left"}),this.$delete(t,"attachedBoards")},changeAttachedBoards:function(t){t.length?this.$set(this.clients[this.activeClientId],"attachedBoards",a()(t)):this.clients[this.activeClientId].attachedBoards&&this.clearAttachMode(this.clients[this.activeClientId])},deleteBoardsHandler:function(t){var e=this;Object.keys(this.clients).forEach(function(s){e.clients[s].attachedBoards&&(e.clients[s].attachedBoards.forEach(function(n,i){t.includes(n)&&e.$delete(e.clients[s].attachedBoards,i)}),e.clients[s].attachedBoards.length||e.clearAttachMode(e.clients[s]))})},addBoardsHandler:function(t){var e=this;if(!this.activeClientId)return!1;var s=this.clients[this.activeClientId],n=!!s.attachedBoards;n&&this.$q.notify({message:"Attach new board to the connection?",timeout:0,type:"info",icon:"mdi-link-variant",position:"bottom-left",closeBtn:!0,actions:[{label:"Attach",handler:function(){e.$set(e.clients[e.activeClientId],"attachedBoards",a()(e.clients[e.activeClientId].attachedBoards).concat(a()(t)))}}]})}},created:function(){var t=this,e=this.$q.sessionStorage.get.item("mqtt-tiles-share");if(this.$route.params.hash||e){this.fullViewMode=!1;var s,n=u();s=this.$route.params.hash?JSON.parse(k["Base64"].decode(this.$route.params.hash)):e,this.$q.sessionStorage.set("mqtt-tiles-share",s),n.username=s.token,n.syncNamespace=s.topic,n.syncToRetain=!0,n.flespiBoard=s.boardId,C["default"].set(this.clients,0,n),this.setActiveClient(0)}else{var i=b["a"].get.item(w["c"]),r=b["a"].get.item(w["a"]);if(i){if(this.clients=i,this.$route.params.flespiToken){var a=this.$route.params.flespiToken.replace("FlespiToken ",""),o=this.clientsIds.filter(function(e){var s=t.clients[e].username.replace("FlespiToken ","");return a===s});if(o.length)r=o[0];else{var l=u();l.username=a;var c=(parseInt(this.clientsIds[this.clientsIds.slice(-1)])+1).toString();C["default"].set(this.clients,c,l),r=c}this.$router.push("/")}r&&this.clients[r]&&this.$nextTick(function(){t.setActiveClient(r)})}}},watch:{clients:{deep:!0,handler:function(t){this.fullViewMode&&I(t)}}},components:{clientSettings:S}},$=_,P=(s("eb60"),Object(f["a"])($,n,i,!1,null,null,null));P.options.__file="MyLayout.vue";e["default"]=P.exports}}]);